================================================================================
SYNTH√àSE DES R√âPONSES - TP SCALA SPARK ANALYSE FRAUDE - Elena Ferreira M2TL
================================================================================

================================================================================
PARTIE 1 ‚Äì PRISE EN MAIN DES DONN√âES (EDA brute)
================================================================================

>>> Question 1 : Chargement des donn√©es

NOMBRE DE COLONNES PAR FICHIER :
- transactions_data : 12 colonnes
- cards_data : 13 colonnes
- users_data : 14 colonnes
- mcc_codes : 2 colonnes

TYPES DE DONN√âES INCORRECTS OU SUSPECTS :

1. transactions_data :
   - amount (String) ‚Üí Devrait √™tre Double/Decimal
     Les valeurs contiennent le symbole "$" (ex: "$-77.00", "$14.57")
   - zip (Double) ‚Üí Devrait √™tre String
     Un code postal est un identifiant, pas une valeur num√©rique

2. cards_data :
   - credit_limit (String) ‚Üí Devrait √™tre Double/Decimal
     Les valeurs contiennent le symbole "$" (ex: "$24295")
   - has_chip (String) ‚Üí Devrait √™tre Boolean
   - card_on_dark_web (String) ‚Üí Devrait √™tre Boolean
   - expires (String) ‚Üí Devrait √™tre Date
   - acct_open_date (String) ‚Üí Devrait √™tre Date

3. users_data :
   - per_capita_income (String) 
   - yearly_income (String)
   - total_debt (String) 
   ‚Üí Devrait √™tre Double/Decimal
     Les valeurs contiennent le symbole "$"

4. mcc_codes :
   - mcc (String) ‚Üí Incoh√©rence avec transactions_data o√π mcc est Integer
     Cela posera probl√®me lors des jointures (n√©cessite cast)

--------------------------------------------------------------------------------

>>> Question 2 : Analyse de volum√©trie

R√âSULTATS :
- Nombre total de transactions : 13 305 915
- Nombre de clients uniques    : 1 219
- Nombre de cartes uniques     : 4 071
- Nombre de commer√ßants uniques: 74 831

Les TRANSACTIONS g√©n√®rent de loin le plus de lignes (13,3 millions).

Ratios calcul√©s :
- Transactions par client     : 13 305 915 / 1 219 ‚âà 10 915 transactions/client
- Cartes par client           : 4 071 / 1 219 ‚âà 3,3 cartes/client
- Transactions par carte      : 13 305 915 / 4 071 ‚âà 3 268 transactions/carte
- Transactions par commer√ßant : 13 305 915 / 74 831 ‚âà 178 transactions/commer√ßant

================================================================================
PARTIE 2 ‚Äì ANALYSE DES MONTANTS & COMPORTEMENTS
================================================================================

>>> Question 4 : Analyse des montants

STATISTIQUES DESCRIPTIVES :
- Moyenne  : 42,98 ‚Ç¨
- M√©diane  : 28,77 ‚Ç¨
- Minimum  : -500,00 ‚Ç¨ (remboursements/annulations)
- Maximum  : 6 820,20 ‚Ç¨

QUARTILES :
- Q1 (25%) : 8,53 ‚Ç¨   ‚Üí 25% des transactions < 8,53 ‚Ç¨
- Q2 (50%) : 28,77 ‚Ç¨  ‚Üí 50% des transactions < 28,77 ‚Ç¨
- Q3 (75%) : 62,93 ‚Ç¨  ‚Üí 75% des transactions < 62,93 ‚Ç¨

DISTRIBUTION PAR TRANCHE :
+------------+---------------+---------------+-----------------+
| Tranche    | Nb transactions | % du total  | Montant moyen   |
+------------+---------------+---------------+-----------------+
| < 10 ‚Ç¨     | 3 574 928     | 26,87%        | -15,38 ‚Ç¨ (*)    |
| 10 - 50 ‚Ç¨  | 5 271 899     | 39,62%        | 26,83 ‚Ç¨         |
| 50 - 200 ‚Ç¨ | 4 134 911     | 31,08%        | 88,97 ‚Ç¨         |
| >= 200 ‚Ç¨   | 324 177       | 2,44%         | 362,37 ‚Ç¨        |
+------------+---------------+---------------+-----------------+
(*) Montant moyen n√©gatif d√ª aux remboursements inclus dans cette tranche

Les montants √©lev√©s sont RARES.

Arguments :
1. Seulement 2,44% des transactions d√©passent 200 ‚Ç¨
2. 97,56% des transactions sont inf√©rieures √† 200 ‚Ç¨
3. La m√©diane (28,77 ‚Ç¨) est nettement inf√©rieure √† la moyenne (42,98 ‚Ç¨)
4. 75% des transactions (Q3) sont inf√©rieures √† 62,93 ‚Ç¨
5. Les tranches basses dominent : 66,49% des transactions sont < 50 ‚Ç¨

--------------------------------------------------------------------------------

>>> Question 5 : Analyse temporelle

PAR HEURE :
- Nuit (0h-5h) : ~6% du volume, minimum √† 3h (103k transactions)
- Journ√©e (6h-16h) : ~65% du volume, pic √† 12h (953k transactions)
- Ratio max/min : 9,2x

PAR JOUR : Distribution homog√®ne (~1,9M/jour), variation < 2%

PAR MOIS : L√©g√®re saisonnalit√© (pic √©t√©, creux f√©vrier/novembre)

ANOMALIES : Les heures 1h-5h sont anormalement CALMES (10x moins que la journ√©e)
‚Üí Transactions nocturnes = signal de vigilance pour la d√©tection de fraude

================================================================================
PARTIE 3 ‚Äì ENRICHISSEMENT M√âTIER (MCC & erreurs)
================================================================================

>>> Question 6 : Jointure avec les MCC

TOP 10 DES CAT√âGORIES PAR VOLUME DE TRANSACTIONS :
+-----+-----------------------------+---------------+
| Rang| Cat√©gorie                   | Nb transactions|
+-----+-----------------------------+---------------+
|  1  | Grocery Stores, Supermarkets| 1 592 584     |
|  2  | Miscellaneous Food Stores   | 1 460 875     |
|  3  | Service Stations            | 1 424 711     |
|  4  | Eating Places and Restaurants| 999 738      |
|  5  | Drug Stores and Pharmacies  | 772 913       |
|  6  | Tolls and Bridge Fees       | 674 135       |
|  7  | Wholesale Clubs             | 601 942       |
|  8  | Money Transfer              | 589 140       |
|  9  | Taxicabs and Limousines     | 500 662       |
| 10  | Fast Food Restaurants       | 499 659       |
+-----+-----------------------------+---------------+

TOP 5 DES CAT√âGORIES PAR MONTANT MOYEN :
+-----+---------------------------------------+-------------+---------------+
| Rang| Cat√©gorie                             | Montant moy | Nb transactions|
+-----+---------------------------------------+-------------+---------------+
|  1  | Cruise Lines                          | 1 551,42 ‚Ç¨  | 428           |
|  2  | Steel Drums and Barrels               | 797,89 ‚Ç¨    | 384           |
|  3  | Fabricated Structural Metal Products  | 786,94 ‚Ç¨    | 408           |
|  4  | Miscellaneous Fabricated Metal Products| 786,78 ‚Ç¨   | 351           |
|  5  | Coated and Laminated Products         | 785,08 ‚Ç¨    | 381           |
+-----+---------------------------------------+-------------+---------------+
‚Üí Cat√©gories industrielles/m√©tallurgiques avec tr√®s peu de transactions mais 
  montants √©lev√©s

Autres cat√©gories notables √† montant √©lev√© :
- Airlines : 729,83 ‚Ç¨ (2 861 transactions)
- Hospitals : 726,08 ‚Ç¨ (3 468 transactions)

Oui, plusieurs cat√©gories pr√©sentent des RISQUES √âLEV√âS.

- Money Transfer : RISQUE √âLEV√â (blanchiment, transactions irr√©versibles)
- Industries m√©tallurgiques : RISQUE MOD√âR√â (peu de transactions, montants √©lev√©s ~780‚Ç¨)
- Cruise Lines / Airlines : RISQUE MOD√âR√â (montants √©lev√©s, cible fraude carte vol√©e)
- Taxicabs : RISQUE MOD√âR√â (blanchiment par fausses courses)
- Grocery / Stations : RISQUE FAIBLE (haut volume, petits montants)

+------------------------+--------+----------------+---------------+
| Cat√©gorie              | Volume | Montant moyen  | Niveau risque |
+------------------------+--------+----------------+---------------+
| Money Transfer         | √âlev√©  | Mod√©r√©         | TR√àS √âLEV√â    |
| Industries m√©tallurgie | Faible | Tr√®s √©lev√©     | √âLEV√â         |
| Cruise Lines / Airlines| Faible | Tr√®s √©lev√©     | MOD√âR√â        |
| Taxicabs               | √âlev√©  | Faible         | MOD√âR√â        |
| Grocery / Stations     | √âlev√©  | Faible         | FAIBLE        |
+------------------------+--------+----------------+---------------+

--------------------------------------------------------------------------------

>>> Question 7 : Analyse des erreurs

STATISTIQUES GLOBALES :
- Transactions avec erreurs : 211 393 / 13 305 915
- Taux d'erreur global : 1,59%

TYPES D'ERREURS LES PLUS FR√âQUENTS :
+------------------------+--------------+-----------+----------------+
| Type d'erreur          | Nb occurrences| %        | Nature         |
+------------------------+--------------+-----------+----------------+
| Insufficient Balance   | 130 902      | 61,92%   | Financi√®re      |
| Bad PIN                | 32 119       | 15,19%   | Authentification|
| Technical Glitch       | 26 271       | 12,43%   | Technique       |
| Bad Card Number        | 7 767        | 3,67%    | Authentification|
| Bad Expiration         | 6 161        | 2,91%    | Authentification|
| Bad CVV                | 6 106        | 2,89%    | Authentification|
| Bad Zipcode            | 1 126        | 0,53%    | Authentification|
+------------------------+--------------+-----------+----------------+

CARTES AVEC TAUX D'ERREUR √âLEV√â (TOP 5) :
+-------+------------------+----------+-----------+
|card_id|total_transactions|nb_erreurs|taux_erreur|
+-------+------------------+----------+-----------+
| 2220  | 6 726            | 1 006    | 14,96% ‚ö†Ô∏è |
| 2644  | 6 530            | 954      | 14,61% ‚ö†Ô∏è |
| 5586  | 6 600            | 951      | 14,41% ‚ö†Ô∏è |
| 5364  | 4 277            | 443      | 10,36% ‚ö†Ô∏è |
| 1016  | 23 424           | 1 226    | 5,23%     |
+-------+------------------+----------+-----------+
‚Üí 4 cartes avec taux > 10% (tr√®s suspect)
‚Üí Aucune carte avec 100% d'erreurs

CLIENTS AVEC TAUX D'ERREUR √âLEV√â (TOP 5) :
+---------+------------------+----------+-----------+
|client_id|total_transactions|nb_erreurs|taux_erreur|
+---------+------------------+----------+-----------+
| 954     | 20 047           | 2 935    | 14,64% ‚ö†Ô∏è |
| 1424    | 15 412           | 822      | 5,33%     |
| 1888    | 40 105           | 2 109    | 5,26%     |
| 1017    | 9 795            | 525      | 5,36%     |
| 464     | 27 619           | 1 196    | 4,33%     |
+---------+------------------+----------+-----------+


Un client avec beaucoup d'erreurs est-il suspect ?
OUI, mais il faut NUANCER selon le TYPE d'erreur.

CLASSIFICATION DES ERREURS PAR NIVEAU DE SUSPICION :

üî¥ ERREURS TR√àS SUSPECTES (indiquent une fraude potentielle) :
- Bad PIN (15,19%) : Quelqu'un essaie des codes au hasard ‚Üí carte vol√©e
- Bad Card Number (3,67%) : Tentative avec faux num√©ro ‚Üí fraude en ligne
- Bad CVV (2,89%) : CVV invent√© ‚Üí carte non en possession du fraudeur
- Bad Expiration (2,91%) : Date devin√©e ‚Üí m√™me logique

üü° ERREURS MOD√âR√âMENT SUSPECTES :
- Bad Zipcode (0,53%) : Code postal incorrect ‚Üí achat en ligne frauduleux
- Combinaisons d'erreurs : Multiples √©checs = tentatives r√©p√©t√©es

üü¢ ERREURS PEU SUSPECTES (souvent l√©gitimes) :
- Insufficient Balance (61,92%) : Client qui d√©pense trop, probl√®me financier
- Technical Glitch (12,43%) : Probl√®me technique, pas de fraude


================================================================================
PARTIE 5 ‚Äì RESTITUTION
================================================================================

>>> Question 10 : Synth√®se finale

================================================================================
1. QUELS PATTERNS PRINCIPAUX SONT OBSERV√âS ?
================================================================================

A) PATTERNS TEMPORELS
--------------------
‚Ä¢ Distribution horaire √† deux pics :
  - Creux nocturne (1h-5h) : ~5% du volume, activit√© 10x inf√©rieure √† la journ√©e
  - Pic en journ√©e (6h-16h) : ~65% du volume, maximum √† 12h (pause d√©jeuner)
  - Activit√© en soir√©e mod√©r√©e (17h-23h)
  
‚Ä¢ Distribution journali√®re homog√®ne :
  - Pas de variation significative entre les jours (~1,9M/jour)
  - √âcart max-min < 2%

‚Ä¢ Saisonnalit√© l√©g√®re :
  - Pic estival (juillet-ao√ªt)
  - Creux en f√©vrier et novembre

B) PATTERNS DE MONTANTS
-----------------------
‚Ä¢ Majorit√© de petits montants, peu de gros montants :
  - M√©diane (28,77‚Ç¨) << Moyenne (42,98‚Ç¨)
  - 66,5% des transactions < 50‚Ç¨
  - Seulement 2,44% des transactions > 200‚Ç¨
  
‚Ä¢ Pr√©sence de montants n√©gatifs (remboursements) :
  - Tranche < 10‚Ç¨ avec moyenne n√©gative (-15,38‚Ç¨)
  - Peuvent masquer des activit√©s suspectes

C) PATTERNS PAR CAT√âGORIE COMMERCIALE
-------------------------------------
‚Ä¢ Concentration du volume sur le quotidien :
  - Top 3 : Grocery (12%), Food Stores (11%), Service Stations (11%)
  
‚Ä¢ Opposition volume/montant :
  - Cat√©gories √† haut volume = petits montants (alimentation, carburant)
  - Cat√©gories √† faible volume = gros montants (croisi√®res, industries)

‚Ä¢ Cat√©gories √† risque identifi√©es :
  - Money Transfer : 589k transactions, vecteur de blanchiment
  - Industries m√©tallurgiques : profil atypique pour particuliers

D) PATTERNS D'ERREURS
---------------------
‚Ä¢ Taux d'erreur global faible (1,59%) mais concentr√© :
  - 99,6% des clients ont un taux < 5%
  - 5 clients outliers avec taux > 5%
  - 1 client extr√™me (954) avec 14,64% d'erreurs

‚Ä¢ Dominance des erreurs financi√®res :
  - "Insufficient Balance" = 62% des erreurs
  - Erreurs d'authentification (PIN, CVV) = 25%

================================================================================
2. QUELS INDICATEURS SEMBLENT UTILES POUR UN FUTUR MOD√àLE ?
================================================================================

A) INDICATEURS TRANSACTIONNELS (par transaction)
-----------------------------------------------------------------------------
| Indicateur              | Type   | Justification                          |
|-------------------------|--------|----------------------------------------|
| amount_cleaned          | Num    | Montant nettoy√© (sans $)               |
| is_high_amount          | Bool   | Montant > 200‚Ç¨ (top 2,44%)             |
| is_very_high_amount     | Bool   | Montant > 500‚Ç¨ (tr√®s rare)             |
| is_night_transaction    | Bool   | Transaction entre 1h et 5h             |
| is_negative_amount      | Bool   | Remboursement/annulation               |
| hour_of_day             | Cat    | Heure de la transaction                |
| day_of_week             | Cat    | Jour de la semaine                     |
| is_online               | Bool   | Transaction en ligne (merchant=ONLINE) |
| mcc_risk_level          | Cat    | Niveau de risque de la cat√©gorie MCC   |
| has_error               | Bool   | Pr√©sence d'erreur sur la transaction   |
| error_type              | Cat    | Type d'erreur si pr√©sente              |

B) INDICATEURS CLIENT (agr√©g√©s par client)
-----------------------------------------------------------------------------
| Indicateur                    | Type | Justification                      |
|-------------------------------|------|------------------------------------|
| client_avg_amount             | Num  | Montant moyen habituel             |
| client_std_amount             | Num  | Variabilit√© des montants           |
| client_transaction_count      | Num  | Volume d'activit√©                  |
| client_error_rate             | Num  | Taux d'erreur global               |
| client_night_transaction_rate | Num  | % de transactions nocturnes        |
| client_high_amount_rate       | Num  | % de transactions > 200‚Ç¨           |
| client_mcc_diversity          | Num  | Nombre de cat√©gories fr√©quent√©es   |
| client_favorite_mcc           | Cat  | Cat√©gorie la plus utilis√©e         |

C) INDICATEURS CARTE (agr√©g√©s par carte)
---------------------------------------------------------------------------
| Indicateur              | Type | Justification                          |
|-------------------------|------|----------------------------------------|
| card_error_rate         | Num  | Taux d'erreur de la carte              |
| card_on_dark_web        | Bool | Carte compromise (donn√©e existante)    |
| card_has_chip           | Bool | Protection physique                    |
| card_age                | Num  | Anciennet√© de la carte                 |
| card_credit_limit       | Num  | Limite de cr√©dit                       |
| card_utilization_rate   | Num  | Taux d'utilisation du cr√©dit           |

D) INDICATEURS COMPORTEMENTAUX (d√©riv√©s)
-----------------------------------------------------------------------------
| Indicateur                      | Type | Justification                    |
|---------------------------------|------|----------------------------------|
| amount_vs_client_avg            | Num  | √âcart au comportement habituel   |
| time_since_last_transaction     | Num  | D√©lai depuis derni√®re transaction|
| is_new_merchant                 | Bool | Premier achat chez ce commer√ßant |
| is_new_mcc                      | Bool | Nouvelle cat√©gorie pour le client|
| consecutive_errors              | Num  | Erreurs cons√©cutives sur carte   |
| velocity_1h                     | Num  | Nb transactions dans l'heure     |
| velocity_24h                    | Num  | Nb transactions dans les 24h     |

================================================================================
3. QUELLES LIMITES PR√âSENTENT CES DONN√âES ?
================================================================================

A) LIMITES DE QUALIT√â DES DONN√âES
---------------------------------
Types de donn√©es incorrects :
    - Montants en String avec symbole "$" ‚Üí n√©cessite nettoyage
    - Bool√©ens en String ("YES"/"NO")
    - Dates en String non pars√©es
    - Incoh√©rence de type sur MCC (int vs string)

Valeurs manquantes potentielles :
   - zip = NULL pour transactions en ligne
   - merchant_state = NULL pour "ONLINE"
   - Pas de v√©rification exhaustive des NULL

Donn√©es non normalis√©es :
   - Pas de conversion de devises (tout en $)
   - Pas d'ajustement pour l'inflation sur 10+ ans de donn√©es

B) LIMITES DE REPR√âSENTATIVIT√â
------------------------------
D√©s√©quilibre de volum√©trie :
   - Seulement 1 219 clients pour 13,3M transactions
   - Chaque client = ~10 000 transactions en moyenne
   - Peu de diversit√© de profils clients

Absence de labels de fraude dans l'analyse exploratoire :
   - On ne sait pas quelles transactions sont r√©ellement frauduleuses
   - N√©cessite train_fraud_labels.json pour valider les hypoth√®ses

Biais g√©ographique probable :
   - Donn√©es am√©ricaines (codes postaux US, √âtats US)
   - Non g√©n√©ralisable √† d'autres march√©s

C) LIMITES TEMPORELLES
----------------------
Donn√©es potentiellement obsol√®tes :
   - D√©but en 2010 ‚Üí comportements de consommation diff√©rents
   - √âvolution des m√©thodes de fraude non capt√©e
   - Pas de donn√©es r√©centes (post-COVID, paiement mobile)

Pas de donn√©es en temps r√©el :
   - Analyse statique, pas de flux continu
   - Impossible de d√©tecter des fraudes "en cours"

D) LIMITES POUR LE MACHINE LEARNING
-----------------------------------
Absence de certaines features importantes :
   - Localisation GPS du t√©l√©phone vs localisation marchand
   - Historique de navigation/device fingerprint
   - Score de cr√©dit en temps r√©el
   - Donn√©es 3D-Secure

Granularit√© insuffisante :
   - Pas d'horodatage √† la seconde (minute seulement)
   - Pas de s√©quence de transactions (num√©ro d'ordre)

Risque de data leakage :
   - Certaines colonnes (errors) peuvent contenir de l'information 
     post-transaction qui ne serait pas disponible en temps r√©el

E) RECOMMANDATIONS POUR AM√âLIORER LES DONN√âES
---------------------------------------------
1. Ajouter des timestamps pr√©cis (millisecondes)
2. Inclure la g√©olocalisation du device
3. Ajouter des donn√©es comportementales (temps de saisie, device)
4. Enrichir avec des donn√©es externes (listes noires, IP reputation)
5. Normaliser les types de donn√©es √† la source
6. Cr√©er un pipeline de mise √† jour en temps r√©el
